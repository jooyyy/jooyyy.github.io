---
layout:     post
title:      项目知识点
subtitle:   
date:       2017-08-24
author:     Joy
header-img: img/page-bg-people.png
catalog: true
tags:
    - Linux
---
* 广播通知
* intent
* socket 
* wifi模块编程

#### Android Wi-Fi 编程

Android提供了android.net.wifi包，让开发者可以方便的管理设备底层无线堆栈

开发过程中可能需要的权限

* ACCESS_WIFI_STATE
* CHANGE_WIFI_STATE
* CHANGE_WIFI_MULTICAST_STATE

要注意的是**不是所有的Android设备都提供Wi-Fi功能，**所以你可能需要在Manifest里面添加一个元素：

```
<manifest...>
	<uses-feature android:name="android.hardware.wifi" />
	...
</manifest>
```



##### 常用Classes

| [ScanResult](https://developer.android.com/reference/android/net/wifi/ScanResult.html) | Describes information about a detected access point. |
| ---------------------------------------- | ---------------------------------------- |
| [WifiConfiguration](https://developer.android.com/reference/android/net/wifi/WifiConfiguration.html) | A class representing a configured Wi-Fi network, including the security configuration. |
| [WifiConfiguration.AuthAlgorithm](https://developer.android.com/reference/android/net/wifi/WifiConfiguration.AuthAlgorithm.html) | Recognized IEEE 802.11 authentication algorithms. |
| [WifiConfiguration.GroupCipher](https://developer.android.com/reference/android/net/wifi/WifiConfiguration.GroupCipher.html) | Recognized group ciphers.                |
| [WifiConfiguration.KeyMgmt](https://developer.android.com/reference/android/net/wifi/WifiConfiguration.KeyMgmt.html) | Recognized key management schemes.       |
| [WifiConfiguration.PairwiseCipher](https://developer.android.com/reference/android/net/wifi/WifiConfiguration.PairwiseCipher.html) | Recognized pairwise ciphers for WPA.     |
| [WifiConfiguration.Protocol](https://developer.android.com/reference/android/net/wifi/WifiConfiguration.Protocol.html) | Recognized security protocols.           |
| [WifiConfiguration.Status](https://developer.android.com/reference/android/net/wifi/WifiConfiguration.Status.html) | Possible status of a network configuration. |
| [WifiEnterpriseConfig](https://developer.android.com/reference/android/net/wifi/WifiEnterpriseConfig.html) | Enterprise configuration details for Wi-Fi. |
| [WifiEnterpriseConfig.Eap](https://developer.android.com/reference/android/net/wifi/WifiEnterpriseConfig.Eap.html) | The Extensible Authentication Protocol method used |
| [WifiEnterpriseConfig.Phase2](https://developer.android.com/reference/android/net/wifi/WifiEnterpriseConfig.Phase2.html) | The inner authentication method used     |
| [WifiInfo](https://developer.android.com/reference/android/net/wifi/WifiInfo.html) | Describes the state of any Wifi connection that is active or is in the process of being set up. |
| [WifiManager](https://developer.android.com/reference/android/net/wifi/WifiManager.html) | This class provides the primary API for managing all aspects of Wi-Fi connectivity. |
| [WifiManager.LocalOnlyHotspotCallback](https://developer.android.com/reference/android/net/wifi/WifiManager.LocalOnlyHotspotCallback.html) | Callback class for applications to receive updates about the LocalOnlyHotspot status. |
| [WifiManager.LocalOnlyHotspotReservation](https://developer.android.com/reference/android/net/wifi/WifiManager.LocalOnlyHotspotReservation.html) | LocalOnlyHotspotReservation that contains the `WifiConfiguration` for the active LocalOnlyHotspot request. |
| [WifiManager.MulticastLock](https://developer.android.com/reference/android/net/wifi/WifiManager.MulticastLock.html) | Allows an application to receive Wifi Multicast packets. |
| [WifiManager.WifiLock](https://developer.android.com/reference/android/net/wifi/WifiManager.WifiLock.html) | Allows an application to keep the Wi-Fi radio awake. |
| [WifiManager.WpsCallback](https://developer.android.com/reference/android/net/wifi/WifiManager.WpsCallback.html) | Interface for callback invocation on a start WPS action |
| [WpsInfo](https://developer.android.com/reference/android/net/wifi/WpsInfo.html) | A class representing Wi-Fi Protected Setup |



### Android 中的 Context 详解

> Interface to global information about an application environment.This is an abstract class whose implementation is provided by the Android system. It allows access to application-specific resources and classes, as well as up-calls for application-level operations such as launching activities, broadcasting and receiving intents.

Context 是一个抽象类，下面看几个该类的实现，它们之间的关系如图：

![context](/img/post-androidcontext.png)

* ContextImpl ，给Activity以及其他的组件提供context对象

  ```
  class ContextImpl extends Context {
      // 所有Application 程序共用一个mPackageInfo对象
      ActivityThread.PackageInfo mPackageInfo;
      
      @Override
      public Object getSystemService(String name) {
          ...
          else if (ACTIVITY_SERVICE.equals(name)) {
            	return getActivityManager();
          }
          else if (INPUT_METHOD_SERVICE.equals(name)) {
             	return InputMethodManager.getInstance(this);
          }
      }
      
      @Override
      public void startActivity(Intent intent) {
        	mMainThread.getInstrumentation().execStartActivity(
        		getOuterContext(),
        		mMainThread.getApplicationThread(),
        		null,
        		null,
        		intent,
        		-1,
        	);
      }
  }
  ```

  ​

* ContextWrapper， 

  ```
  public class ContextWrapper extends Context {
  	//该属性指向一个ContextImpl实例，一般在创建Application,Service,Activity时赋值
    	Context mBase; 
    	
    	protected void attachBaseContext(Context base) {
        	if (mBase != null) {
            	throw new IllegalStateException("Base context already set");
        	}
        	mBase = base;
    	}
    	
    	@Override
    	public void startActivity(Intent intent) {
        	mBase.startActivity(intent);
    	}
  }
  ```

* ContextThemeWrapper

  ```
  public class ContextThemeWrapper extends ContextWrapper {
    	private Context mBase;
    	
    	public ContextThemeWrapper(Context base, int themeres) {
        	super(base);
        	mBase = base;
        	mThemeResource = themeres;
    	}
    	
    	@Override
    	protected void attachBaseContext(Context newBase) {
        	super.attachBaseContext(newBase);
        	mBase = newBase;
    	}
  }
  ```



##### Context 作用域

* Activity 生成的Context拥有最大的作用域，这个和继承关系相关

##### Context 内存泄漏问题

一般Context造成的内存泄漏，几乎都是当Context销毁的时候，却因为被引用导致销毁失败（如static对象的生命周期比较长，Context和这个关联起来之后，很容易出问题）

正确的使用：

* Application 的 Context能搞定的情况下，且生命周期比较长的对象，优先使用Application的Context
* 不要让生命周期长于Activity的对象持有Activity引用
* 尽量不要在Activity中使用非静态内部类，因为非静态内部类会隐士持有外部类实例的引用，如果使用静态内部类，将外部实例引用作为弱引用持有