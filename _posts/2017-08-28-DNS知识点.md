---
layout:     post
title:      DNS相关
subtitle:   
date:       2017-08-28
author:     Joy
header-img: img/page-bg-people.png
catalog: true
tags:
    - DNS
    - Golang
---

#### 基本概念
* DNS 

  Domain Name Service - 域名解析服务

  DNS 也是 C/S 架构的，有客户端、服务器两个部分，服务器端一般是BIND(Berkley Internet Name Domain)，客户端一般是共享库

* DNS端口：53/udp, 53/tcp

* 解析库：以某种方式存储”键值对“信息的数据库

  * 文本文件：缺点明显就是当数据量大了之后，查找一条信息效率非常低。
  * 关系型数据库：把”特征信息“抽取出来单独做成小型数据库用于检索；当数据量级进一步增大之后，还是会有效率问题。这是还可以对索引进行进一步分级，比如将100条索引做成一个索引来划分。
  * LDAP（Lightweight Directory Access Protocol）

##### DNS 解析的建构演化

* 早起使用本地hosts文件来存放“IP地址”与“目标主机名”的对应关系
* 中期由中心DNS服务器提供hosts文件，进一步使用高可用服务器集群来提供服务
* 域名解析的结果会被缓存到本地，以减轻服务器的压力
* 域名解析进入分布式阶段
  * 根域：Root Domain
  * 一级域：Top-Level Domain      com, net, org
  * 二级域：公司、组织或者个人可以直接申请  baidu, google 
  * 三级域或者主机名：www,  mail 

##### 域名查询过程

* 层级递归查询：A问B，B不知道，但B知道C知道，于是B问C，C页不知道，但C知道D知道

* 迭代查询：A问B，B不知道，但B知道C知道，于是A去问C，C不知道，但C知道D知道，于是A去问D

  **DNS查询使用先递归，后迭代的方法**, 反向查询是通过IP查询域名

 ##### 区域解析库（zone）

每一行是一个解析条目，叫做“资源记录（resource record或者rr）”

##### NS（Name Server）

本地区的名称服务器，负责本地域内主机的DNS解析，可能有多个

##### SOA（Start of Authority） 

用来标记区域内的DNS主服务器是谁

##### MX（Mail eXchange）

邮件交换器

##### A

负责正向名称解析

##### PTR

负责反向名称解析

##### AAAAA

负责IPv6地址的正向域名解析

##### CNAME（Canonical Name）

正式名称



---



#### DNS客户端进行域名解析的流程

* 先查hosts文件
* 若没有，查本地DNS缓存
  * mac 下清理自己的 DNS 缓存
  > sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder; say DNS cache flushed;
* 若没有，再查DNS服务器
  * 先查DNS服务器的本地DNS缓存
  * 若没有，再查DNS服务器的解析库
  * 都没有，那DNS向根域发起请求，开始迭代查询



