---
layout:     post
title:      Android 网络编程
subtitle:   
date:       2017-08-28
author:     Joy
header-img: img/page-bg-people.png
catalog: true
tags:
    - Android
---

#### Socket 

> This class implements client sockets (also called just "sockets"). A socket is an endpoint for communication between two machines.
>
> The actual work of the socket is performed by an instance of the **SocketImpl** class. An application, by changing the socket factory that creates the socket implementation, can configure itself to create sockets appropriate to the local firewall.

Socket 的构造函数

* Socket()：创建一个新的未连接的Socket

* Socket(Proxy proxy)：使用指定的代理类型创建一个新的未连接的Socket

  ```
  Socket sock = new Socket(new Proxy(Proxy.Type.SOCKS, new InetSocketAddress("test.domain.org", 2130)));
  ```

  ​

* Socket(String dstName, int dstPort)：使用指定的目标服务器的IP地址和目标服务器的端口号，创建一个新的Socket

* Socket(String dstName, int dstPort, InetAddress localAddress, int localPort)：使用指定的目标主机、目标端口、本地地址和本地端口，创建一个新的Socket

* Socket(InetAddress dstAddress, int dstPort)：使用指定的本地地址和本地端口，创建一个新的Socket

* Socket(InetAddress dstAddress, int dstPort, InetAddress localAddress, int localPort)：使用指定的目标主机、目标端口、本地地址和本地端口，创建一个新的Socket



##### TCP 通信

* 服务端工作的步骤

  * ServerSocket(int port)，创建ServerSocket并绑定到指定的端口上

  * 调用accept()，监听连接请求，如果客户端请求连接，则接受连接，返回通信套接字

  * 调用Socket的getOutputStream()和getInputStream()获取输出和输入流

  * 关闭

    ```
    try {
     // 初始化 Socket，TCP_SERVER_PORT 为指定的端口，int 类型
     Socket socket = new Socket("localhost", TCP_SERVER_PORT);
     // 获取输入流
     BufferedReader in = new BufferedReader(new
     InputStreamReader(socket.getInputStream()));
     // 生成输出流
     BufferedWriter out = new BufferedWriter(new
     OutputStreamWriter(socket.getOutputStream()));
     // 生成输出内容
     String outMsg = "TCP connecting to " + TCP_SERVER_PORT +
     System.getProperty("line.separator");
     // 写入
     out.write(outMsg);
     // 刷新，发送
     out.flush();
     // 获取输入流
     String inMsg = in.readLine() + System.getProperty("line.separator");
     Log.i("TcpClient", "received: " + inMsg);
     // 关闭连接
     socket.close();
     } catch (UnknownHostException e) {
     	e.printStackTrace();
     } catch (IOException e) {
     	e.printStackTrace();
     }
    ```

    ​

##### UDP通信 

Java使用DatagramSocket代表UDP协议的Socket，DatagramSocket能做的事情只是接收和发送数据报（DatagramPacket），而实际上的数据都是通过DatagramPacket来完成。

* DatagramSocket

  > This class represents a socket for sending and receiving datagram packets.
  >
  > A datagram socket is the sending or receiving point for a packet delivery service. Each packet send or receiveed on a datagram socket is individually addressed and routed differently, and may arrive in any order.

  * receive(DatagramPacket p)  从该DatagramSocket中接收数据报
  * send(Datagrampacket p) 从该DatagramSocket对象向外发送数据包报

* DatagramPacket

  > This class represents a datagram packet.
  >
  > Datagram packets are used to implement a connectionless packet delivery service. Each message is routed from one machine to another based solely on information contained within that packet.Multiple packets sent from one machine to another might be routed differently, and might arrive in any order. Packet delivery is not guaranteed.

构造器：

- DatagramPacket(byte[] buf, int length)：以一个空数组来创建DatagramPacket对象，该对象的作用是接收DatagramSocket中的数据
- DatagramPacket(byte[] buf, int length, InetAddress addr, int port)：以一个包含数据的数组来创建DatagramPacket对象，创建该DatagramPacket对象时还指定了Ip地址和端口，决定了数据报的目的地址