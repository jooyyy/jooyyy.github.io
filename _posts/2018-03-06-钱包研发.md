---
layout:     post
title:      钱包搭建
subtitle:   
date:       2018-03-06
author:     Joy
header-img: img/page-bg-people.png
catalog: true
tags:
    - 数字货币钱包
---

#### 钱包
##### 钱包类型
* 确定性钱包
	* 由一串随机数生成器生成种子，对种子进行单向Hash运算得到---->私钥
* 非确定性钱包
	* 预先生成私钥，每个私钥只用一次
	* 难以管理和备份

##### 助记词
> BIP0039 定义助记码和种子的创建过程如下：
>
> * 创造出一个128到256位的随机顺序（熵）
> * 提出SHA256哈希前几位，就可以创造一个随机序列的校验和
> * 把校验和加在随机顺序的后面
> * 把顺序分解成11位的不同集合，并用这些集合去和一个预先已经定义的2048个单词字典做对应
> * 生成一个12至24个词的助记码

开源的2048英文助记词[地址](https://github.com/bitcoin/bips/blob/master/bip-0039/english.txt)

##### HD钱包
* 确定性钱包，HD（Hierarchical Deterministic 分层确定性），通过种子，一次一次进行 Divide 计算得到子私钥，再得到对应层级的公钥和地址
* 分层确定性在 BIP32协议中提出
* BIP43 对 BIP32 树结构增加了子索引标识 purpose 的扩展
	> m/purpse'/*
* BIP44 在 BIP32/BIP43 基础上添加了多币种，通过 HD 钱包派生多个地址，可以同时管理主网和测试网的比特币
	> m/purpse'/coin_type'/account'/change/address_index
* HD 钱包生成的过程
![img](/img/guide.jpg)
	* 获取一个助记词
	* （BIP39）使用 PBKDF2 转化为种子
	* 种子使用 HMAC-SHA512 生成根私钥
	* 从该根私钥，导出子私钥（BIP32）其中节点布局由BIP44设置
* 目前已知以太坊客户端的具体实现：
	* m/44'/60'/0'/0/x: BIP44，imToken(可以自定义路径)，MetaMask，Jaxx，MyEtherWallet，TREZOR，Exodus
	* m/44'/60'/x'/0/0: BIP44，KeepKey， MetaMask
	* m/44'/60'/0'/x: Electrum，Ledger Chrome 

## go-ethereum
* 完整同步  geth –syncmode full
* 快速同步  geth –fast –cache 512
* 开启RPC
	* 直接开启，默认监听 localhost 8545端口
	* 自定义 geth --rpc --rpcaddr <ip> --rpcport <portnumber> 
* 发起RPC 
	```
	curl localhost:8545 -X POST --data '{"jsonrpc":"2.0","method":"eth_getTransactionByHash","params":["0x3f23fd13083d11c49b5a2ea296ae066bd814abff4fe47875f6ed290e4ab6936f"], "id":12}' -H "Content-Type: application/json"
	```
	得到结果:
	```
	{
　　"jsonrpc":"2.0",
　　"id":12,
　　"result":{
　　　　"blockHash":"0x8370992ac128ad2e4f7bac28ecec90f93749662927983ab4f1310d85583790c0",
　　　　"blockNumber":"0x50f837",
　　　　"from":"0xf0614d9129d51e4e4a217e45133784e94b896a5f",
　　　　"gas":"0xd004",
　　　　"gasPrice":"0x12a05f200",
　　　　"hash":"0xb60e98d5525336b3970dfe23023912ac7bbe868f068d0ebe4a53ee719e7e539c",
　　　　"input":"0xa9059cbb000000000000000000000000daed26203878c9bf130fa2530d19c18bf3a8421d00000000000000000000000000000000000000000000158be0e8d1653c180000",
　　　　"nonce":"0xcf",
　　　　"to":"0x80fb784b7ed66730e8b1dbd9820afd29931aab03",
　　　　"transactionIndex":"0x25",
　　　　"value":"0x0",
　　　　"v":"0x26",
　　　　"r":"0x5082eb17322fb326256e16e66349b859f606a9cca8f1a28578070bbbe1e465da",
　　　　"s":"0x335cea67b6c6b80bf0c9273bf1ee67dc04d9a1d9e2c208fec327db7d27b745bb"
　　}
}
	```
	上面这次交易比较特殊，0x80fb784b7ed66730e8b1dbd9820afd29931aab03这个地址是一个合约地址，该地址下保存有代币自定义的协议，input中为具体的指令hash、接收的token账户、代币数量。
	* 在input中，前4个字节（8个16进制数）为方法名sha3编码之后的前4个字节（8个16进制数）
	* 在input中，需要将40个16进制数前面填充24个0，总共64个16进制数
	* 将数量转化成16进制，填充0得到64个16进制
* geth 上智能合约相关的操作
	* 遵循 ERC20 的 Token 实际上就是用各自的方案实现了同一组 function；ERC20 看起来就像 Java 中的 interface。
	* eth_call 方法，在input（有的地方叫data）参数中放入经过 ABI（application binary interface） encode 的方法。


